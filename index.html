<!DOCTYPE html>
<head>
	<meta charset="utf-8">
	<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"></script>
	
	<!-- D3.geo -->
    <script src="https://d3js.org/d3.geo.projection.v0.min.js"></script>
    
	<!-- jQuery -->
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
	
	
	<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css" rel='stylesheet'>
	
	<script src="data/forceData.js"></script>
	<script src="data/importData.js"></script>
	<script src="data/countries.js"></script>
  
  <!-- Roboto & Asar CSS -->
	<link href='https://fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css'>
	<link href="https://fonts.googleapis.com/css?family=Asar" rel="stylesheet">
  <style>
  	.button .item {
	  margin: 10px 0;
	  /*float: left; Remove this*/
	  display: inline-block; /*Add this*/
	}
	
	.button{
		margin-top: -10vh;
	}
  	
    body { 
      margin:0;
      position:fixed;
      top:0;right:0;bottom:0;left:0;
      overflow-y: hidden;
   	}
   	
   	#content{
	   	overflow-y: hidden;
	   	
   	}
    #container {
      position: relative;
      z-index: 2;
      overflow-y: hidden;

    }
    #sticky { 
      position: absolute; 
      top: 0; 
      right: 0; 
      width: 55%; 
      z-index: 3;
    }
    .panel {
      width: 100%;
      padding-left: 20px;
      padding-top: 25vh;
    }
    .panel p {
      padding-right: 60%;
      max-width: 500px;
      min-width: 400px;
      padding-bottom: 10vh;
    }
    .panel:first-child {
      /* padding-top: 35vh; */
      margin-top: -100px;
    }
    .panel:last-child {
      padding-bottom: 10vh;
    }
    #tip{
		font-family: 'Asar', serif;
		background: white;
		box-shadow: 0 0 5px #999999;
		color: #333;
		font-size: 14px;
		right: 350px;
		padding: 10px;
		position: absolute;
		width:200px;
		text-align: center;
		top: 400px;
		z-index: 10;
		display: block;
		opacity: 0;
	}
	
	.axis line,.axis path {
	  fill: none;
	  stroke: #000;
	  shape-rendering: crispEdges;
	}
	
	.x.axis path {
	  display: none;
	}
	
	.line {
	  fill: none;
	  stroke: steelblue;
	  stroke-width: 2px;
	}
	
	.red{
		color:#b2182b;
	}
	.orange{
		color:#ef8a62;
	}
	.blue{
		color: #2166ac;
	}
	.bold{
		font-weight: 500;
		font-size: 18px;
	}
	
	.marginTop50{
		margin-top: 50px;
	}
	body{
	  font-family: 'Asar', serif;
	}
	
	#sticky{
				
	}
	
	.arrow {
	  text-align: left;
	  margin: 8% 0;
	}
	.bounce {
	  -moz-animation: bounce 2s infinite;
	  -webkit-animation: bounce 2s infinite;
	  animation: bounce 2s infinite;
	}
	
	@keyframes bounce {
	  0%, 20%, 50%, 80%, 100% {
	    transform: translateY(0);
	  }
	  40% {
	    transform: translateY(-30px);
	  }
	  60% {
	    transform: translateY(-15px);
	  }
	}
	
	.fa{
		color:black;
	}
	

</style>
</head>

<body>
  
  <div id="sticky">
  </div>
  <div id="tip"></div>
 
  
  
  <div id="container" style="height: 100vh; overflow: scroll">
    <div id="content">
 

      <div class="panel">
      	<div class="arrow bounce">
		        <i class="fa fa-arrow-down fa-2x" href="#"></i>
		        <p class="orange">Scroll Down From Left </p>
		    </div>
       <div><h1>CYCLES OF DESTRUCTION:</h1>
       		<h2>Unsustainability, Illegality, <br>and Violence in the<span class="red"> Hongmu Trade</span> </h2>
	        <br>
	        
	         <h3> Situation </h3>
	         <br>
	        <p>Meaning ‘red wood’ in Chinese, the term Hongmu refers to a range of richly hued durable tropical hardwoods used to produce high-end reproduction furniture, flooring and handicrafts.</p>
	        <br>
	        <p>In recent years, China’s growing middle class has driven up demand, usually for low to midrange Hongmu species, resulting in the sector reaching industrial scales. Rapid growth has created a poorly structured market with little regulation. 
	        </p>
	        <br>
	        <p>The expanding hongmu trade has driven successive boom and bust cycles all over the world, marked by unsustainable harvest, multiple legal violations(theft,smuggling,corruption),and violence in source countries.
	        </p>
	        <br>
	        <p>
	        Demand for this rosewood in China has grown exponentially over the past 15 years, from 144,500m3 imported in 2000 to over 2 million m3 in 2014.
	        </p>
	        
      </div>
      
      <div class="panel">
        <h3> Are Hongmu Species Protected? </h3>
        <br>
        <p>Only 8 out of 33 Hongmu species are protected under CITES.</p>
         <p class="orange"> Hover over circle to see species </p>
         <!-- <p><span id="currentScrollTop"></span></p> -->
      </div>
   
      <div class="panel">
        <h3> Demand and Transit Countries </h3>
        <br>
	        <p>
	         Because most hongmu species are not protected under CITES, and because the main demand side country, China, and key trade and processing hub Vietnam, do not prohibit the import of illegally harvested and/or traded timber, illegal wood from these species is legally placed in the markets there everyday.
	        </p>
	      	
      </div>
      
      <div class="panel">
        <h3> Source Countries </h3>
        <p>Soaring demand for scarce hongmu resources has caused supply chains to expand from Southeast Asia to new frontiers in West Africa and Central America. Nearly half of the world’s countries (88 in total) across five continents have been targeted by traders since 2000.</p>
	        <p class="bold">Africa</p>
	        <p>Hongmu exports from West Africa have grown more than 1,000 fold between 2010 and 2015. West Africa is now the world’s
leading hongmu-producing region by volume.</p>
	        <p class="orange">Sequence through the years to see the change in import volume between 2010 and 2016 from West African countries.</p>
		  	<div class="button">
			  	<button type="button" id="stepBackward" class="item">
			  		<i class="fa fa-arrow-left" aria-hidden="true"></i>
			  	</button>
			  	<div id="yearLabel" class="item">2010</div>
				<button type="button" id="stepForward" class="item">
					<i class="fa fa-arrow-right" aria-hidden="true"></i>
				</button>
			</div>

	    <br>
	        <p class="bold">Asia</p>
	        <p>Although the reported volume from Central America is relatively small, the region has <i>Dalbergia</i> species with very limited distributions that are particularly vulnerable to commercial extinction.</p>
	    <br>
	        <p class="bold">Latin America</p>
	      	<p>With the commercial extinction of Huang Hua Li <i>Dalbergia odorifera</i> in China and heavy restrictions placed on the harvest and export of CITES-listed Red Sandalwood <i>Pterocarpus santialinus</i> in India, Siamese Rosewood <i>Dalbergia cochinchinensis</i> became the most sought-after hongmu species globally</p>
      </div>

      
      
      <div class="panel">
        <h3> Proposed Solutions </h3>
        <br>
        <p>1. Amend the annotation for the Appendix II listing for <i>Dalbergia cochinchinensis</i> to cover all parts
and derivatives commonly found in trade<br>2. Include 13 timber species of genus <i>Dalbergia</i>, native to Mexico and Central America, in Appendix II <br>3. List all <i>Dalbergia</i> species under Appendix II <br>4. List four species of the genus <i>Gibourtia</i> under Appendix II to prevent misdeclaration of hongmu species <br>5. Transfer <i>Pterocarpus erinaceus</i> from
Appendix III to Appendix II.</p>

      </div>

    </div>
  </div>
  
 
  <script>
  

	// set up svg and scrolling
    var width = window.innerWidth / 2
    var height = window.innerHeight
    
    var translate = 'translate(' + (width / 2) + ',' + (height / 2) + ')'

   
    
    var svg = d3.select("#sticky").append("svg")
    	.attr('width', width)
    	.attr('height', height);
    
         	
   

    var currentScrollTop = d3.select('#currentScrollTop')
   
    
    var body = d3.select('body').node()
    var container = d3.select('#container')
    var content = d3.select('#content')
    
    var SCROLL_LENGTH = content.node().getBoundingClientRect().height - height
       
    var scrollTop = 0
    var newScrollTop = 0
    
		container
  		.on("scroll.scroller", function() {
      		newScrollTop = container.node().scrollTop
	    });

    var setDimensions = function() {
      width = window.innerWidth / 2
			height = window.innerHeight
      SCROLL_LENGTH = content.node().getBoundingClientRect().height - height
      
   
    }
    
    
    
    var render = function() {
      if (scrollTop !== newScrollTop) {
        scrollTop = newScrollTop
    
        
        currentScrollTop.text(scrollTop)
        
        /* console.log(scrollTop); */
	       	
	       	
	    //scroll statements
	       	if(scrollTop >= 350){
		         d3.selectAll(".title")
		    		.transition()
		    		.duration(100)
		    		.style('opacity',0);
		         
	         }else{
		         d3.selectAll(".title")
		    		.transition()
		    		.duration(100)
		    		.style('opacity',1);
	         }	    
	         
	         
	        
	         if(scrollTop >= 350 && scrollTop <=550){
	         	 d3.selectAll(".stat1")
		    		.transition()
		    		.duration(100)
		    		.style('opacity',1);
		    	
	         }else{
		          d3.selectAll(".stat1")
		    		.transition()
		    		.duration(100)
		    		.style('opacity',0);
		           
	         }
	         
	         if(scrollTop >= 550 && scrollTop <=750){
	         	 d3.selectAll(".stat2")
		    		.transition()
		    		.duration(100)
		    		.style('opacity',1);
		    	
	         }else{
		          d3.selectAll(".stat2")
		    		.transition()
		    		.duration(100)
		    		.style('opacity',0);
		           
	         }
	         
	         if(scrollTop >= 750 && scrollTop <=950){
	         	 d3.selectAll(".stat3")
		    		.transition()
		    		.duration(100)
		    		.style('opacity',1);
		    	
		    	d3.selectAll(".stat3-1")
		    		.transition()
		    		.duration(100)
		    		.style('opacity',1);
		    	
	         }else{
		          d3.selectAll(".stat3")
		    		.transition()
		    		.duration(100)
		    		.style('opacity',0);
		    	
		    	d3.selectAll(".stat3-1")
		    		.transition()
		    		.duration(100)
		    		.style('opacity',0);
		    	  
		    	  
		           
	         }
	         
	         if(scrollTop >= 950 && scrollTop <=1150){
	         	 d3.selectAll(".stat4")
		    		.transition()
		    		.duration(100)
		    		.style('opacity',1);
		    	
	         }else{
		          d3.selectAll(".stat4")
		    		.transition()
		    		.duration(100)
		    		.style('opacity',0);
		           
	         }


	         
	         
	         if(scrollTop >= 600){
		    	 d3.selectAll(".horizontalGrid")
		    	 .transition()
		         .duration(200)
		    	 .style('opacity',0);
		    	 
		    	 d3.selectAll(".axis")
		         .transition()
		         .duration(200)
		    	 .style('opacity',0);
		         
	         }else{

		         d3.selectAll(".horizontalGrid")
		         .transition()
		         .duration(200)
		    	 .style('opacity',1);
		         
		    	 d3.selectAll(".axis")
		         .transition()
		         .duration(200)
		    	 .style('opacity',1);
		         
	         }
	         
	         
	        if(scrollTop >= 1300 && scrollTop <=1750){
	          d3.selectAll(".circle")
		    		.transition()
		    		.duration(100)
		    		.style('opacity',1);
		    		
		    	d3.selectAll(".invisRect").remove();
		    	
		    	d3.selectAll(".stat5")
		    		.transition()
		    		.duration(100)
		    		.style('opacity',1);
	        
	        
	        
	        
	        }else{
		         
		        d3.selectAll(".circle")
		    		.transition()
		    		.duration(100)
		    		.style('opacity',0);
		    	
		    	svg.append("rect")
  				.attr("class","invisRect")  
  				.attr("x", 0)
  				.attr("y", 0)                                  
		        .attr("width", width)
                .attr("height", height)
                .attr("fill","transparent");
                
                d3.selectAll(".stat5")
		    		.transition()
		    		.duration(100)
		    		.style('opacity',0);
	        } 
	         
	    
	         if(scrollTop >= 1850){
		         d3.selectAll("path.line")
		    		.style('opacity',0);

		         
	         }else{
		         
		         d3.selectAll("path.line")
		    		.style('opacity',1);
	         }
	        
	        if(scrollTop >= 1850 && scrollTop <=2300){
		       d3.selectAll("path.china")
		    		.transition()
		    		.duration(100)
		    		.style('opacity',1);
		    		
		    	
	        }else{

		        d3.selectAll("path.china")
		    		.transition()
		    		.duration(100)
		    		.style('opacity',0);

		        
		    
	        }
	        
	        
	        if(scrollTop >= 2450 && scrollTop <=3000){
		       d3.selectAll("path.africancountries")
		    		.transition()
		    		.duration(100)
		    		.style('opacity',1);
		       d3.selectAll("path.bgcountries")
		    		.transition()
		    		.duration(100)
		    		.style('opacity',1);
		    		
		    	
	        }else{

		        d3.selectAll("path.africancountries")
		    		.transition()
		    		.duration(100)
		    		.style('opacity',0);
		    		
		    	d3.selectAll("path.bgcountries")
		    		.transition()
		    		.duration(100)
		    		.style('opacity',0);
		    
	        }
	        
	        if(scrollTop >= 3000 && scrollTop <=3400){
		       d3.selectAll("path.asiancountries")
		    		.transition()
		    		.duration(100)
		    		.style('opacity',1);
		       d3.selectAll("path.bgcountries2")
		    		.transition()
		    		.duration(100)
		    		.style('opacity',1);
		    		
		    	
	        }else{

		        d3.selectAll("path.asiancountries")
		    		.transition()
		    		.duration(100)
		    		.style('opacity',0);
		    		
		    	d3.selectAll("path.bgcountries2")
		    		.transition()
		    		.duration(100)
		    		.style('opacity',0);
		    
	        }
	        
	        
	        if(scrollTop >= 3400 && scrollTop <=3700){
		       d3.selectAll("path.latincountries")
		    		.transition()
		    		.duration(100)
		    		.style('opacity',1);
		       d3.selectAll("path.bgcountries3")
		    		.transition()
		    		.duration(100)
		    		.style('opacity',1);
		    		
		    	
	        }else{

		        d3.selectAll("path.latincountries")
		    		.transition()
		    		.duration(100)
		    		.style('opacity',0);
		    		
		    	d3.selectAll("path.bgcountries3")
		    		.transition()
		    		.duration(100)
		    		.style('opacity',0);
		    
	        }
	        
	        

	        
	         
        
        
      }
      
      window.requestAnimationFrame(render)
    }
    window.requestAnimationFrame(render)
    
    window.onresize = setDimensions
    

var textGroup = svg.append('g');
  		
  		
  		textGroup.append("text")
  		.attr("class", "title")
  		.style("font-size","40px")
  		.attr("x", (width / 5) +50)
  		.attr("y", (height / 2)-50)
  		.text("Hongmu Trade ");
  		
  		textGroup.append("text")
  		.attr("class", "stat1")
  		.style("font-size","40px")
  		.attr("x", width / 6)
  		.attr("y", (height / 2)-50)
  		.text("350 Imports per Hour")
  		.style('opacity',0);
  		
  		textGroup.append("text")
  		.attr("class", "stat2")
  		.style("font-size","30px")
  		.attr("x", width / 7)
  		.attr("y", (height / 2)-50)
  		.text("1300% Increase from 2009 to 2014")
  		.style('opacity',0);
  		
  		textGroup.append("text")
  		.attr("class", "stat3")
  		.style("font-size","40px")
  		.attr("x", width / 4)
  		.attr("y", (height / 2)-50)
  		.text("30000 Companies")
  		.style('opacity',0);
  		
  		textGroup.append("text")
  		.attr("class", "stat3-1")
  		.style("font-size","30px")
  		.attr("x", width / 7)
  		.attr("y", (height / 2))
  		.text("Make up China's hongmu industry")
  		.style('opacity',0);
  		
  		textGroup.append("text")
  		.attr("class", "stat4")
  		.style("font-size","30px")
  		.attr("x", width / 6)
  		.attr("y", (height / 2)-50)
  		.text("25 Billion USD worth of profits")
  		.style('opacity',0);
  		
  		
  		textGroup.append("text")
  		.attr("class", "stat5")
  		.style("font-size","30px")
  		.attr("x", width / 7)
  		.attr("y", (height / 2)-120)
  		.text("Less than 25% of species are protected")
  		.style('opacity',0);  
    
createLine(svg);
createChinaMap(svg);
createAfricaMap(svg);
createAsiaMap(svg);
createAmericaMap(svg);
createForce(svg);


//line graph

function createLine(svg){
		
		var newHeight = height - 100;
		var newWidth = width - 100;
		
		

		var x = d3.scale.linear()
			    .range([0, newWidth]);
			
		var y = d3.scale.linear()
		    .range([newHeight, 50]);
		    

		
		var color = d3.scale.category10();
		
		var xAxis = d3.svg.axis()
		    .scale(x)
		    .ticks(5)
		    .orient("bottom")
		    .tickFormat(d3.format("d"));
		
		var yAxis = d3.svg.axis()
		    .scale(y)
		    .ticks(5)
		    .orient("left");
		
		var line = d3.svg.line()
		    .interpolate("basis")
		    .x(function(d) { return x(d.Year); })
		    .y(function(d) { return y(d.price); });
  		
  	
  		d3.csv("data/import_fake.csv", function(error, data) {
	  		  color.domain(d3.keys(data[0]).filter(function(key) { return key !== "Year"; }));
	
			  data.forEach(function(d) {
			    /* d.Year =+d.Year; */
			    d.All =+d.All;
			    d.Asia =+d.Asia;
			    d.LatinAmerica =+d.LatinAmerica;
			    d.Africa =+d.Africa;
			    d.Other =+d.Other;
			  });
			
			  var continents = color.domain().map(function(name) {
			    return {
			      name: name,
			      values: data.map(function(d) {
			        return {Year: d.Year, price: +d[name]};
			      })
			    };
			   });
			   
			   
			   console.log(data);
			   console.log(continents);
			    
			  
			  x.domain(d3.extent(data, function(d) { return d.Year; }));
	
			  	
			  y.domain([
			    d3.min(continents, function(c) { return d3.min(c.values, function(v) { return v.price; }); }),
			    d3.max(continents, function(c) { return d3.max(c.values, function(v) { return v.price; }); })
			  ]);
			  
			  
			
			  svg.append("g")
			      .attr("class", "x axis")
			      .attr("transform", "translate(80," + newHeight + ")")
			      .call(xAxis)
			      .append("text")
					  .attr("class", "label")
					  .attr("x", newWidth)
					  .attr("y", -6)
					  .style("text-anchor", "end")
					  .text("year");
					  
			  
			  svg.append("g")
			      .attr("class", "title")
			      .attr("transform", "translate(80," + newHeight + ")")
			      .append("text")
					  .attr("class", "label")
					  .attr("x", 310)
					  .attr("y", 50)
					  .style("text-anchor", "end")
					  .text("CHINA’S HONGMU IMPORTS BY CONTINENT");
					  
			  svg.append("g")
			      .attr("class", "y axis")
			      .attr("transform", "translate(80,0)")
			      .call(yAxis)
			      .append("text")
					  .attr("class", "label")
					  .attr("transform", "rotate(-90)")
					  .attr("x", -50)
					  .attr("y", 12)
					  .style("text-anchor", "end")
					  .text("cubic meters");

			  svg.append("line")
			        .attr(
			        {
			            "class":"horizontalGrid",
			            "x1" : 80,
			            "x2" : newWidth+80,
			            "y1" : y(0),
			            "y2" : y(0),
			            "fill" : "none",
			            "shape-rendering" : "crispEdges",
			            "stroke" : "black",
			            "stroke-width" : "1px",
			            "stroke-dasharray": ("3, 3")
			        });
			
			
			  var continent = svg.selectAll(".continent")
			      .data(continents)
			    .enter().append("g")
			      .attr("class", "continent");
			
			
			
			  var path = svg.selectAll(".continent").append("path")
			      .attr("class", "line")
			      .attr("transform", "translate(80,0)")
			      .attr("d", function(d) { return line(d.values); })
			      .style("stroke", function(d) { if (d.name == "All") 
			                                        {return "#b2182b"}
			                                     else if(d.name == "Africa"){return "#ef8a62"}
			                                     else if(d.name == "Asia"){return "#2166ac"}
			                                     else if(d.name == "LatinAmerica"){return "#67a9cf"}
			                                     else{return "#fddbc7";}
			                                         });
	  		/* console.log(path); */
	  		
	  		var totalLength = [path[0][0].getTotalLength(), path[0][1].getTotalLength(),path[0][2].getTotalLength(),path[0][3].getTotalLength(),path[0][4].getTotalLength()];
	
			console.log(totalLength);
			
			
			   d3.select(path[0][0])
			      .attr("stroke-dasharray", totalLength[0] + " " + totalLength[0] ) 
			      .attr("stroke-dashoffset", totalLength[0])
			      .transition()
			        .duration(5000)
			        .ease("linear")
			        .attr("stroke-dashoffset", 0);
			
			   d3.select(path[0][1])
			      .attr("stroke-dasharray", totalLength[1] + " " + totalLength[1] )
			      .attr("stroke-dashoffset", totalLength[1])
			      .transition()
			        .duration(5000)
			        .ease("linear")
			        .attr("stroke-dashoffset", 0);
			   
			   d3.select(path[0][2])
			      .attr("stroke-dasharray", totalLength[2] + " " + totalLength[2] )
			      .attr("stroke-dashoffset", totalLength[2])
			      .transition()
			        .duration(5000)
			        .ease("linear")
			        .attr("stroke-dashoffset", 0);
			  
			  d3.select(path[0][3])
			      .attr("stroke-dasharray", totalLength[3] + " " + totalLength[3] )
			      .attr("stroke-dashoffset", totalLength[3])
			      .transition()
			        .duration(5000)
			        .ease("linear")
			        .attr("stroke-dashoffset", 0);
			  
			  d3.select(path[0][4])
			      .attr("stroke-dasharray", totalLength[4] + " " + totalLength[4] )
			      .attr("stroke-dashoffset", totalLength[4])
			      .transition()
			        .duration(5000)
			        .ease("linear")
			        .attr("stroke-dashoffset", 0);

			        
		
		});

}//end createLine



function createChinaMap(svg){
    
var projection = d3.geo.mercator()
  .scale(500)
  // Center the Map in Colombia
  .center([100, 35])
  .translate([width / 2, height / 2]);

 var path= d3.geo.path()
  .projection(projection);


 var features = countries.features;   
 
 var china_vietnam = features.filter(function(d){
 	return d.properties.name == 'China' || d.properties.name == 'Vietnam';
 })
 
 console.log(china_vietnam);
 	 
 
 var mapLayer = svg.append('g');
 
 mapLayer.selectAll("path")
	.data(china_vietnam)
	.enter()
	.append("path")
	.attr("d", path)
	.attr("class","china")
	.style("stroke", "white")
	.style("stroke-width", "1")
	.style("fill", "#2166ac")
	.style("opacity", 0);

} //end createChinaMap 
    



function createAfricaMap(svg){
	var DataArray = ["2010","2011","2012","2013","2014","2015","2016"];
	var expressed = DataArray[0];
	var attributeIndex = 0
	
	var projection = d3.geo.mercator()
	  .scale(1000)
	  // Center the Map in Colombia
	  .center([-3, 15])
	  .translate([width / 2, height / 2]);
	
	 var path = d3.geo.path()
	  .projection(projection);
	
	
	 var features = countries.features; 
	 
	 var west_africa = features.filter(function(d){
	 	return d.properties.name == 'Nigeria' || d.properties.name == 'Ghana' || d.properties.name == 'Gambia' || d.properties.name == 'Guinea-Bissau' || d.properties.name == 'Benin';
	 });
	 
	 var background_countries = features.filter(function(d){
	 	return d.properties.name == 'Burkina Faso' || d.properties.name == 'Ivory Coast' || d.properties.name == 'Liberia' || d.properties.name == 'Guinea' || d.properties.name == 'Togo' || d.properties.name == 'Senegal' || d.properties.name == 'Mali' || d.properties.name == 'Mauritania' || d.properties.name == 'Sierra Leone' || d.properties.name == 'Western Sahara' || d.properties.name == 'Morocco' || d.properties.name == 'Algeria' || d.properties.name == 'Niger' || d.properties.name == 'Nigeria' || d.properties.name == 'Chad' || d.properties.name == 'Cameroon' || d.properties.name == 'Equatorial Guinea' || d.properties.name == 'Gabon' || d.properties.name == 'Republic of the Congo' || d.properties.name == 'Libya' || d.properties.name == 'Central African Republic' || d.properties.name == 'Tunisia'; });
	
	var bg = svg.append('g');
	var bgCountries = bg.selectAll(".bgcountries")
	            .data(background_countries)
	            .enter()
	            .append("path")
	            .attr("class", "bgcountries")
	            .attr("d", path)
	            .style("stroke", "white")
	            .style("stroke-width", "1")
	            .style("fill", "#eaeaea")
	            .style("opacity",0);
	
	
	d3.csv("data/africa.csv", function(error, data) {
		var myfeatures= joinData(west_africa, data, DataArray);
		
		var colorScale = makeColorScale(myfeatures);
		
		var africaMap = svg.append('g');
		var westAfricaCountries = africaMap.selectAll(".africancountries")
	            .data(myfeatures)
	            .enter()
	            .append("path")
	            .attr("class", function(d){
	                return "Africa " + d.properties.name+" africancountries";
	            })
	            .attr("d", path)
	            .style("fill", function(d) {
		          return choropleth(expressed, d.properties, colorScale);
		      })
		      .style("stroke", "white")
	            .style("stroke-width", "1")
		      .style("opacity",0);
		      
		     
		
		      
	    	createSequenceControls(DataArray, attributeIndex, expressed, myfeatures);
		
	});

}    

function createSequenceControls(DataArray, attributeIndex, expressed, thisfeatures){

      var yearLabel = d3.select("#yearLabel")
        .text(expressed)

        $("#stepForward").on("click", function(){
            attributeIndex +=1
              if(attributeIndex > DataArray.length){
                attributeIndex = 0
              }

            expressed = DataArray[attributeIndex]

            d3.select("#yearLabel")
              .text(expressed)

            changeAttribute(expressed, thisfeatures)
        })

        $("#stepBackward").on("click", function(){
            attributeIndex -=1

              if(attributeIndex < 0){
                attributeIndex = DataArray.length-1
              }

              expressed = DataArray[attributeIndex]

              d3.select("#yearLabel")
                .text(expressed)

              changeAttribute(expressed, thisfeatures)
        })
}

//dropdown change listener handler
function changeAttribute(thisexpressed, thisfeatures){
	/* console.log("peeg"); */
    //recreate the color scale
    var colorScale = makeColorScale(thisfeatures);

    //recolor enumeration units
    d3.selectAll(".africancountries")
        .style("fill", function(d){
            return choropleth(thisexpressed, d.properties, colorScale)
        });
};


function makeColorScale(data){
	
    //create color scale generator
    var colorScale = d3.scale.threshold()
        .domain([0,5000,20000,40000,60000])
        .range(['#fef0d9','#fdd49e','#fdbb84','#fc8d59','#e34a33','#b30000']);
        /* .range(['#2166ac','#67a9cf','#d1e5f0','#fddbc7','#ef8a62','#b2182b']); */

    return colorScale;
};

function choropleth(expressed, props, colorScale){
    //make sure attribute value is a number

    var val = parseInt(props[expressed]);

    //if attribute value exists, assign a color; otherwise assign gray
    if (val){
        return colorScale(val);
    } else {
        return "#CCC";
    };
};


function joinData(thisFeatures, thisData, DataArray){


    //loop through csv to assign each set of csv attribute values to geojson counties
    for (var i=0; i<thisData.length; i++){
      var csvCountry = thisData[i]; //the current county
      var csvKey = csvCountry.Country; //the CSV primary key

      //loop through geojson regions to find correct counties
      for (var a=0; a<thisFeatures.length; a++){

          var geojsonProps = thisFeatures[a].properties; //the current region geojson properties
          var geojsonKey = geojsonProps.name; //the geojson primary key

          //where primary keys match, transfer csv data to geojson properties object
          if (geojsonKey == csvKey){
              //assign all attributes and values
              DataArray.forEach(function(attr){
                  var val = parseFloat(csvCountry[attr]); //get csv attribute value
                  geojsonProps[attr] = val; //assign attribute and value to geojson properties
              });
          };
      };
    };
    /* console.log(thisFeatures); */
    return thisFeatures;
};



function createAsiaMap(svg){

	
	var projection = d3.geo.mercator()
	  .scale(800)
	  .center([110, 10])
	  .translate([width / 2, height / 2]);
	
	 var path = d3.geo.path()
	  .projection(projection);
	
	
	 var features = countries.features; 
	 
	 var SE_Asia = features.filter(function(d){
	 	return d.properties.name == 'Laos' || d.properties.name == 'Myanmar' || d.properties.name == 'Vietnam' || d.properties.name == 'Indonesia' || d.properties.name == 'Cambodia' || d.properties.name == 'Thailand';
	 });
	 
	 var background_countries = features.filter(function(d){
	 	return  d.properties.name == 'China' || d.properties.name == 'India' || d.properties.name == 'Taiwan' || d.properties.name == 'Philippines' || d.properties.name == 'Malaysia';
	 });
	 
	 console.log(SE_Asia);
	
	var bg = svg.append('g');
	var bgCountries = bg.selectAll(".bgcountries2")
	            .data(background_countries)
	            .enter()
	            .append("path")
	            .attr("class", "bgcountries2")
	            .attr("d", path)
	            .style("stroke", "white")
	            .style("stroke-width", "1")
	            .style("fill", "#eaeaea")
	            .style("opacity",0);
	            
	 var SE_AsiaCountries = bg.selectAll(".asiancountries")
	            .data(SE_Asia)
	            .enter()
	            .append("path")
	            .attr("class", "asiancountries")
	            .attr("d", path)
	            .style("stroke", "white")
	            .style("stroke-width", "1")
	            .style("fill", "#fdd49e")
	            .style("opacity",0);

}  



function createAmericaMap(svg){

	
	var projection = d3.geo.mercator()
	  .scale(1000)
	  .center([-90, 15])
	  .translate([width / 2, height / 2]);
	
	 var path = d3.geo.path()
	  .projection(projection);
	
	
	 var features = countries.features; 
	 
	 var LatinAmerica = features.filter(function(d){
	 	return d.properties.name == 'Nicaragua' || d.properties.name == 'Belize' || d.properties.name == 'Mexico' || d.properties.name == 'Panama' || d.properties.name == 'Guatemala' || d.properties.name == 'Honduras';
	 });
	 
	 var background_countries = features.filter(function(d){
	 	return  d.properties.name == 'Costa Rica' || d.properties.name == 'El Salvador' || d.properties.name == 'Colombia' || d.properties.name == 'Venezuela' || d.properties.name == 'Ecuador';
	 });
	 
	 console.log(LatinAmerica);
	
	var bg = svg.append('g');
	var bgCountries = bg.selectAll(".bgcountries3")
	            .data(background_countries)
	            .enter()
	            .append("path")
	            .attr("class", "bgcountries3")
	            .attr("d", path)
	            .style("stroke", "white")
	            .style("stroke-width", "1")
	            .style("fill", "#eaeaea")
	            .style("opacity", 0);
	            
	 var LatinCountries = bg.selectAll(".latincountries")
	            .data(LatinAmerica)
	            .enter()
	            .append("path")
	            .attr("class", "latincountries")
	            .attr("d", path)
	            .style("stroke", "white")
	            .style("stroke-width", "1")
	            .style("fill", "#fdbb84")
	            .style("opacity", 0);

}  

       
         
function createForce(svg){         
         
    /* force layout  */       	
        var nodes = graph.nodes;
        
        var padding = 1.5, // separation between same-color nodes
		    clusterPadding = 6; // separation between different-color nodes
		var maxRadius  = 5; // total number of nodes
		var n = nodes.length;

		
  		var clusters = {}; // collect clusters from nodes
  		nodes.forEach(function(d){
  			var radius = d.radius;
  			var clusterID = d.cluster;
  			if (!clusters[clusterID] || (radius > clusters[clusterID].r)) { 
  				clusters[clusterID] = d;
  			}
  		}); /* console.log(clusters); */
  		
  		
  		 var force = d3.layout.force()
					  .nodes(nodes)
					  .size([width, height])	  
					  .gravity(.02)
					  .charge(1)
					  .on("tick", tick)
					  .start();
		var g =svg.append('g');
		var tooltip = d3.select('#tip');
			
  			tooltip.append('div').attr('class', 'species');		
  		
		var circles = g.selectAll('.circle')
						 .data(nodes)
						 .enter().append("circle")
						 .attr("class","circle")
						 .attr("r", function(d) { return d.radius; })
						 .attr("fill", function(d) { return d.color; })
						 .attr('stroke', 'black')
						 .attr('stroke-width', 1)
						 .call(force.drag)
						 .on("mouseover",function(d){
						 	console.log(d);
						 	tooltip.select('.species').html("<b class='blue'> Species </b><i>" + d.species + "</i><br> "+d.common);
							tooltip.style('display', 'block');
							tooltip.style('opacity', 2);
							d3.select(this).attr("fill", function(d){
								if(d.cluster=='1'){
									return "#67a9cf";
								}else{
									return "#fddbc7";
								}});
						 })
						.on('mouseout', function (d, i) {
							
							tooltip.style('display', 'none');
							tooltip.style('opacity', 0);
							d3.select(this).attr("fill", function(d){return d.color;});
						})
						.style('opacity',0);
						
			function tick(e) {
			  circles
			      .each(cluster(10 * e.alpha * e.alpha))
			      .each(collide(.5))
			      .attr("cx", function(d) { return d.x; })
			      .attr("cy", function(d) { return d.y; });
		      }
		
			// Move d to be adjacent to the cluster node.
			function cluster(alpha) {
			  return function(d) {
			    var cluster = clusters[d.cluster],
			        k = 1;
			
			    // For cluster nodes, apply custom gravity.
			    if (cluster === d) {
			      cluster = {x: width / 2, y: height / 2, radius: -d.radius};
			      k = .1 * Math.sqrt(d.radius);
			    }
			
			    var x = d.x - cluster.x,
			        y = d.y - cluster.y,
			        l = Math.sqrt(x * x + y * y),
			        r = d.radius + cluster.radius;
			    if (l != r) {
			      l = (l - r) / l * alpha * k;
			      d.x -= x *= l;
			      d.y -= y *= l;
			      cluster.x += x;
			      cluster.y += y;
			    }
			  };
			}
			
			// Resolves collisions between d and all other circles.
			function collide(alpha) {
			  var quadtree = d3.geom.quadtree(nodes);
			  return function(d) {
			    var r = d.radius + maxRadius + Math.max(padding, clusterPadding),
			        nx1 = d.x - r,
			        nx2 = d.x + r,
			        ny1 = d.y - r,
			        ny2 = d.y + r;
			    quadtree.visit(function(quad, x1, y1, x2, y2) {
			      if (quad.point && (quad.point !== d)) {
			        var x = d.x - quad.point.x,
			            y = d.y - quad.point.y,
			            l = Math.sqrt(x * x + y * y),
			            r = d.radius + quad.point.radius + (d.cluster === quad.point.cluster ? padding : clusterPadding);
			        if (l < r) {
			          l = (l - r) / l * alpha;
			          d.x -= x *= l;
			          d.y -= y *= l;
			          quad.point.x += x;
			          quad.point.y += y;
			        }
			      }
			      return x1 > nx2 || x2 < nx1 || y1 > ny2 || y2 < ny1;
			    });
			  };
			}
		
}
  		
  		
  		


	 var rect = svg.append("rect")
  				.attr("class","invisRect")  
  				.attr("x", 0)
  				.attr("y", 0)                                  
		        .attr("width", width)
                .attr("height", height)
                .attr("fill","transparent");


	  

		
    
  </script>
</body>
